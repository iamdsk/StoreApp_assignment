<!DOCTYPE html>
<html>
<head>
<title>Index</title>
</head>
<body>
    <a href="/">Index</a> | <a href="login.html">Login</a> | <a href="register.html">Register</a>
    <form method="POST" action="/api/login">
<table>
    <tr>
        <td><label>User Name </label></td>
        <td><input type="text" name="username" required></td>
    </tr>
    <tr>
        <td><label>Password</label>  </td>
        <td><input type="password" name="password" required></td>
    </tr>
    <tr><td></td>
        <td><button type="Submit">Submit</button></td>
    </tr>
    
    var validateUserClientSide=function()
    {        
        if(typeof(Storage)!=="undefiend")
        {
            //get data from localstorage
            var strValidUser=localStorage.getItem("validuser");
            var validUser=JSON.parse(strValidUser);

            // get data from HTML controls of login.html
            var txtUserName=document.getElementById("username");
            var userName=txtUserName.value;
            var txtPassword=document.getElementById("password");
            var password=txtPassword.value;
            
            var status=false;
            if(validUser.username == userName && validUser.password== password){
                status=true;
            }

            if(status){
                var divId=document.getElementById("result");
                divId.innerHTML="Valid User !"
            }
            else{
                var divId=document.getElementById("result");
                divId.innerHTML="Invalid User !"
            }
        }
    }

    $.ajax({
        type:"POST",
        url:"/api/login",
        data:{user:$("#username").val(),
        password:$("#password").val()
        },
        success:function(result){
            console.log("In the reponse");
            console.log(result);

        $.ajax({
            type:"POST",
            url:"/api/orders",
            data:{user:$(#user).val()},
            success:async function(result){
                console.log("In respose")
                console.log(result);
                let res=await result;
                sessionStorage.setItem("id",res);
                id=result;
            },
            error:function(err){
                console.log(err);
            }
        if(result){
            console.log(id);
            sessionStorage.setItem("user",$("user").val())
            window.location.href="./cart.html";
        }
        else{
            alert("nvalid credentials");
        }
        },
        error:function(err){
            console.log(err);
        }
        )}
    })

</table>
    </form>
</body>
</html>
